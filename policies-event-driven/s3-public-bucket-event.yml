policies:
- name: s3-public-bucket-remediation-event
  resource: aws.s3
  description: 'Blocks S3 bucket public access when it is enabled. Triggered by Lambda on CloudTrail events: PutBucketAcl, DeleteBucketPublicAccessBlock, PutBucketPolicy'
  filters:
  - or:
    - type: check-public-block
      BlockPublicAcls: false
    - type: check-public-block
      IgnorePublicAcls: false
    - type: check-public-block
      BlockPublicPolicy: false
    - type: check-public-block
      RestrictPublicBuckets: false
  actions:
  - type: set-public-block
    BlockPublicAcls: true
    IgnorePublicAcls: true
    BlockPublicPolicy: true
    RestrictPublicBuckets: true
  - type: tag
    tags:
      c7n-remediation: public-access-blocked
      c7n-remediation-date: '{now:%Y-%m-%d}'
  - type: post-finding
    severity_label: MEDIUM
    compliance_status: FAILED
    title: S3 Bucket Public Access Detected and Remediated
    description: 'S3 bucket had public access enabled and was automatically remediated.

      All public access settings have been blocked.

      '
    recommendation: Review bucket access requirements and use IAM policies instead
      of public access.
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - template: aws-basic_email.html
    to:
    - ysrinu95@gmail.com
    - event-owner
    - resource-owner
    transport:
      type: sqs
      queue: https://sqs.us-east-1.amazonaws.com/172327596604/custodian-mailer-queue
    type: notify
    priority_header: 1
    subject: '[c7n] [{{ account }}] S3 Bucket Public Access Detected and Remediated
      ({{ region }})'
    violation_desc: S3 bucket had public access enabled
    action_desc: 'Actions taken: All public access settings have been blocked.'
