policies:
- name: aws-elb-http-listeners-without-https
  resource: app-elb
  description: 'Notifies on LB HTTP listeners in use that do not redirect to HTTPS'
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: listener
    key: Protocol
    value: HTTP
  - type: listener
    matched: true
    key: DefaultActions[].RedirectConfig.Protocol
    value:
    - HTTPS
    op: ne
  actions:
  - template: aws-basic_email.html
    to:
    - ysrinu95@gmail.com
    - event-owner
    - resource-owner
    transport:
      type: sqs
      queue: https://sqs.us-east-1.amazonaws.com/172327596604/custodian-mailer-queue
    type: notify
    priority_header: 1
    subject: '[c7n] [{{ account }}] LB HTTP Listeners in use that do not redirect
      to HTTPS found ({{ region }})'
    violation_desc: LB HTTP Listeners in use that do not redirected to HTTPS
    action_desc: "LB HTTP Listeners in use that do not redirected to HTTPS. Please\
      \ configure HTTPS or redirect HTTP to HTTPS.       \n<a href=\"https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html#listener-configuration\"\
      >Documentation</a>          \n"
vars:
  tags:
    contact: ysrinu95@gmail.com
    environment: production
    repo: ysrinu95/cloud-custodian
  email-notify:
    template: aws-basic_email.html
    to:
    - ysrinu95@gmail.com
    - event-owner
    - resource-owner
    transport:
      type: sqs
      queue: https://sqs.us-east-1.amazonaws.com/172327596604/custodian-mailer-queue
