policies:
- name: ec2-public-instances-periodic-check
  resource: aws.ec2
  description: Periodic check for public EC2 instances using Step Function remediation.
    Runs every 6 hours to catch instances that may have been missed by real-time monitoring.
  filters:
  - type: value
    key: State.Name
    value: running
  - type: value
    key: PublicIpAddress
    value: not-null
  - type: value
    key: Tags[?Key == 'custodian:stepfunction-processed'] | length(@)
    value: 0
  actions:
  - type: invoke-sfn
    state-machine: arn:aws:states:{region}:172327596604:stateMachine:EC2PublicInstanceRemediation
