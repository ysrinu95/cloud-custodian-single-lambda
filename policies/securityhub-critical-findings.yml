policies:
- name: securityhub-critical-findings
  resource: aws.securityhub-finding
  description: 'Detects critical and high severity findings from Security Hub CSPM controls. This includes AWS Foundational Security Best Practices and CIS benchmarks.'
  filters:
  - type: value
    key: Severity.Label
    op: in
    value:
    - CRITICAL
    - HIGH
  - type: value
    key: RecordState
    value: ACTIVE
  - or:
    - type: value
      key: ProductFields.StandardsArn
      op: regex
      value: .*(aws-foundational-security-best-practices|cis-aws-foundations-benchmark).*
  - type: value
    key: Types[0]
    op: in
    value:
    - Software and Configuration Checks/AWS Security Best Practices
    - Effects/Data Exposure
    - Unusual Behaviors
  actions:
  - type: post-finding
    compliance_status: FAILED
    severity_label: HIGH
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    template: aws-basic_email.html
    priority_header: '1'
    violation_desc: Security Hub Critical Finding Detected
    action_desc: 'A critical or high severity Security Hub finding has been detected.

      This may indicate a security misconfiguration or vulnerability.

      '
    to:
    - security-team@optum.com
    transport:
      type: sqs
      queue: https://sqs.us-east-1.amazonaws.com/172327596604/custodian-mailer-queue
