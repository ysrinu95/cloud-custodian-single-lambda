policies:
- name: aws-ecs-long-running-data-schema-tasks
  resource: aws.ecs-task
  description: 'Detects and stops Data Schema ECS tasks running for more than 1 hour'
  filters:
  - type: value
    key: clusterArn
    op: contains
    value: data_schema
  - type: value
    value_type: age
    key: startedAt
    op: gt
    value: 0.042
  - type: value
    key: lastStatus
    value: running
    value_type: normalize
  - tag:c7n-exception:long-running: absent
  actions:
  - type: stop
  - template: aws-basic_email.html
    to:
    - ysrinu95@gmail.com
    - event-owner
    - resource-owner
    transport:
      type: sqs
      queue: https://sqs.us-east-1.amazonaws.com/172327596604/custodian-mailer-queue
    type: notify
    violation_desc: 'Data Schema ECS tasks have been running for more than 1 hour

      '
    action_desc: "ECS tasks have been stopped.          \n"
vars:
  tags:
    contact: ysrinu95@gmail.com
    environment: production
    repo: ysrinu95/cloud-custodian
  email-notify:
    template: aws-basic_email.html
    to:
    - ysrinu95@gmail.com
    - event-owner
    - resource-owner
    transport:
      type: sqs
      queue: https://sqs.us-east-1.amazonaws.com/172327596604/custodian-mailer-queue
