policies:
- name: aws-iam-role-admin-access-report
  resource: aws.iam-role
  description: 'Notifies of IAM roles with administrator permissions'
  filters:
  - or:
    - type: has-specific-managed-policy
      value: AdministratorAccess
    - type: check-permissions
      match: allowed
      actions:
      - '*:*'
  - tag:c7n-exception:iam-admin: absent
  - not:
    - type: value
      key: RoleName
      op: regex
      value: (AWSReservedSSO_)\w+
  actions:
  - template: aws-basic_email.html
    to:
    - ysrinu95@gmail.com
    - event-owner
    - resource-owner
    transport:
      type: sqs
      queue: https://sqs.us-east-1.amazonaws.com/172327596604/custodian-mailer-queue
    type: notify
    subject: '[c7n] [{{ account }}] IAM Roles With Administrator Permissions'
    violation_desc: IAM principal not following a least-privilege model
    action_desc: 'Please update the resources to follow a least-privilege model.<br>

      <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege">Documentation</a>

      '
vars:
  tags:
    contact: ysrinu95@gmail.com
    environment: production
    repo: ysrinu95/cloud-custodian
  email-notify:
    template: aws-basic_email.html
    to:
    - ysrinu95@gmail.com
    - event-owner
    - resource-owner
    transport:
      type: sqs
      queue: https://sqs.us-east-1.amazonaws.com/172327596604/custodian-mailer-queue
